% !TEX program = latexmk
% !TEX options = -jobname=Matthew_Santos_Projects -synctex=1 -interaction=nonstopmode -shell-escape -lualatex %DOC%

%------------------------
% Github Project List
% Author: Matthew Santos
% Last Updated: August 2025
%------------------------

\documentclass{templates/resume}
\usepackage{luacode}
\markdownSetup{
	%gfmAutoIdentifiers,
	%linkAttributes,
	hashEnumerators,
	smartEllipses,
	%unicodeNormalization,
	contentBlocks,
	renderers = {
		headingOne = {{\large{#1}}},
		headingTwo = {{\large{#1}}},
		headingThree = {{\large{#1}}},
		headingFour = {{\large{#1}}},
		link = {\href{#3}{#1}},
		emphasis = {\bfseries{#1}},
		codeSpan = {{\tt #1}}, 
	}
}

% Load Json Project List
\begin{luacode}
	require("lualibs.lua")
	local f = io.open('projects/repoList.json', 'r')
	local s = f:read('*a')
	f:close()
	data =  utilities.json.tolua(s)
\end{luacode}

% Print Formated, Topics Tag based, Repo List from Loaded Json Data
\newcommand{\printRepos}[1]{
	\directlua{
		tex.print("\\begin{samepage}\\section{\\uppercase{#1}}\\vspace{0.5\\baselineskip}")
		for i,row in ipairs(data) do
			if data[i].repositoryTopics then
				local topic = data[i].repositoryTopics[1].name
				if topic == "#1" then
					local name = data[i].name
					local description = string.gsub(data[i].description, "&", "\\&")
					local date = string.sub(data[i].createdAt,1,10) .. " - " .. string.sub(data[i].updatedAt,1,10)
					if data[i].primaryLanguage then
						language = data[i].primaryLanguage.name
					else
						language = " "
					end
					tex.sprint("\\resumeEntry{\\large\\href{https://github.com/Matt-Santos/".. name .."}{\\faGithub\\hspace{0.1cm}".. name .."}}{".. description .."}{".. language .."}{".. date .."}{}{}")
					tex.sprint("\\markdownInput{projects/".. name .."/documents/README.md}")
					tex.sprint("\\vspace{0.5\\baselineskip}")
				end
			end
		end
		tex.print("\\end{samepage}")
	}
}

% 


% Project List Formating Macro
% \newcommand{\printRepos}[1]{
% 	\begin{samepage}
% 	\section{\uppercase{#1}}\vspace{0.5\baselineskip}
% 	\foreach \x in {1,...,15}{
% 		\accesslua{data[\x]["repositoryTopics"][1]["name"]}
% 		\IfEq*{\Result}{#1}{
% 			\accesslua{data[\x]["name"]}
% 			\resumeEntry{\large
% 				\href{https://github.com/Matt-Santos/\Result}
% 				{\faGithub~\Result}}
% 				{\printlua{data[\x]["description"]}}
% 				{\printlua{data[\x]["primaryLanguage"]["name"]}}
% 				{\accesslua{data[\x]["createdAt"]}\StrLeft{\Result}{10} - \accesslua{data[\x]["updatedAt"]}\StrLeft{\Result}{10}}{}
% 				{}
% 			\accesslua{data[\x]["name"]}
% 			%\markdownInput{projects/\Result/documents/README.md}\vspace{0.5\baselineskip}
% 		}{} % false case
% 	}
% 	\end{samepage}
% }


% Main
%--------------------------------------
\begin{document}
	\header%\vfill
	
	% Metadata (Job Specific Keywords)
	\hypersetup{
		pdftitle={Matthew Santos Projects},
		pdfsubject={Projects},
		pdfkeywords={Electrical Engineer}
	}

	\printRepos{research}
	\printRepos{electronics}
	\printRepos{programming}
	%\printRepos{misc}
	
\end{document}

